(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.Jsi = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(e){return void 0===e?"undefined":_typeof2(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":_typeof2(e)},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),Jsi=function(){function e(t){_classCallCheck(this,e),void 0===t&&(t=document),this.doc=t,this.created=new Map,this.eltEvent=new Map,this.eltEvent.set("onclick","click"),this.eltEvent.set("onchange","change"),this.eltEvent.set("onfocus","focus"),this.eltEvent.set("onblur","blur"),this.eltEvent.set("onkeyup","keyup"),this.eltEvent.set("onkeypress","keypress"),this.eltEvent.set("onsubmit","submit"),this.eltEvent.set("onanimationend","animationend"),this.eltEvent.set("ontransitionend","transitionend"),this.eltEvent.set("oncopy","copy"),this.eltEvent.set("oncut","cut"),this.eltEvent.set("ondblclick","dblclick"),this.eltEvent.set("oninvalid","invalid"),this.eltEvent.set("onmousedown","mousedown"),this.eltEvent.set("onmouseup","mouseup"),this.eltEvent.set("onmouseenter","mouseenter"),this.eltEvent.set("onmouseleave","mouseleave"),this.eltEvent.set("onmousemove","mousemove"),this.eltEvent.set("onmouseout","mouseout"),this.eltEvent.set("onmouseover","mouseover"),this.eltEvent.set("onpaste","paste"),this.eltEvent.set("onresize","resize"),this.eltEvent.set("onscroll","scroll"),this.eltEvent.set("onselect","select"),this.eltEvent.set("ontouchstart","touchstart"),this.eltEvent.set("ontouchmove","touchmove"),this.eltEvent.set("ontouchend","touchend"),this.eltEvent.set("ondrag","drag"),this.eltEvent.set("ondragend","dragend"),this.eltEvent.set("ondragenter","dragenter"),this.eltEvent.set("ondragleave","dragleave"),this.eltEvent.set("ondragover","dragover"),this.eltEvent.set("ondragstart","dragstart"),this.eltEvent.set("ondrop","drop"),this.eltEvent.set("oninput","input"),this.eltEvent.set("onloadstart","loadstart"),this.eltEvent.set("onprogress","progress"),this.eltEvent.set("onsuspend","suspend"),this.eltEvent.set("onabort","abort"),this.eltEvent.set("onerror","error"),this.eltEvent.set("onemptied","emptied"),this.eltEvent.set("onstalled","stalled"),this.eltEvent.set("onloadedmetadata","loadedmetadata"),this.eltEvent.set("onloadeddata","loadeddata"),this.eltEvent.set("oncanplay","canplay"),this.eltEvent.set("oncanplaythrough","canplaythrough"),this.eltEvent.set("onplaying","playing"),this.eltEvent.set("onwaiting","waiting"),this.eltEvent.set("onseeking","seeking"),this.eltEvent.set("onseeked","seeked"),this.eltEvent.set("onended","ended"),this.eltEvent.set("ondurationchange","durationchange"),this.eltEvent.set("ontimeupdate","timeupdate"),this.eltEvent.set("onplay","play"),this.eltEvent.set("onpause","pause"),this.eltEvent.set("onratechange","ratechange"),this.eltEvent.set("onresize","resize"),this.eltEvent.set("onvolumechange","volumechange")}return _createClass(e,[{key:"id",value:function(e){return this.doc.getElementById(e)}},{key:"query",value:function(e){var t=this.doc.querySelectorAll(e);return t.length>0?t:null}},{key:"queryFirst",value:function(e){return this.doc.querySelector(e)}},{key:"select",value:function(e){var t=this.id(e);return null===t&&(t=this.queryFirst(e)),t}},{key:"append",value:function(e,t,n){if(void 0===t.tag&&void 0===t.isTextNode||(t=this.create(t)),"object"!=(void 0===e?"undefined":_typeof(e))&&(e=this.select(e)),null!==e&&void 0!==e){var o=e.appendChild(t);return void 0!==n&&(o=e),o}throw e+" cannot be found"}},{key:"appendBefore",value:function(e,t){if(void 0!==t.tag&&(t=this.create(t)),"object"!=(void 0===e?"undefined":_typeof(e))&&(e=this.select(e)),null!==e&&void 0!==e)return e.parentNode.insertBefore(t,e);throw e+" cannot be found"}},{key:"appendAfter",value:function(e,t){if(void 0!==t.tag&&(t=this.create(t)),"object"!=(void 0===e?"undefined":_typeof(e))&&(e=this.select(e)),null!==e&&void 0!==e)return e.parentNode.insertBefore(t,e.nextSibling);throw e+" cannot be found"}},{key:"prepend",value:function(e,t){if(void 0!==t.tag&&(t=this.create(t)),"object"!=(void 0===e?"undefined":_typeof(e))&&(e=this.select(e)),null!==e&&void 0!==e)return 0===e.childNodes.length?this.append(e,t):e.insertBefore(t,e.firstChild);throw e+" cannot be found"}},{key:"replace",value:function(e,t){if(void 0!==t.tag&&(t=this.create(t)),"object"!=(void 0===e?"undefined":_typeof(e))&&(e=this.select(e)),null!==e&&void 0!==e){return e.parentNode.replaceChild(t,e)}throw e+" cannot be found"}},{key:"remove",value:function(e){return"object"!=(void 0===e?"undefined":_typeof(e))&&(e=this.select(e)),null!==e&&void 0!==e&&e.parentNode.removeChild(e)}},{key:"empty",value:function(e){if("object"!=(void 0===e?"undefined":_typeof(e))&&(e=this.select(e)),null!==e&&void 0!==e){for(;e.lastChild;)e.removeChild(e.lastChild);return e}}},{key:"textNode",value:function(e){return this.doc.createTextNode(e)}},{key:"create",value:function(e){var t=null;if(void 0!==e.isTextNode)t=this.textNode(e.content);else{if(this.created.has(e.tag)||this.created.set(e.tag,this.doc.createElement(e.tag)),t=this.created.get(e.tag).cloneNode(),void 0!==e.attr)for(var n in e.attr)if(this.eltEvent.has(n))t.addEventListener(this.eltEvent.get(n),e.attr[n]);else switch(n){case"checked":t.checked=e.attr[n];break;case"className":t.setAttribute("class",e.attr[n]);break;default:t.setAttribute(n,e.attr[n])}if(void 0!==e.innerForce&&(t.innerHTML=e.innerForce),void 0!==e.append)for(var o in e.append)t=this.append(t,e.append[o],!0);void 0!==e.inner&&t.appendChild(this.textNode(e.inner)),void 0!==e.initCallback&&"function"==typeof e.initCallback&&e.initCallback(t)}return t}},{key:"eltFromString",value:function(e){var t=e;try{e=(new Range).createContextualFragment(t)}catch(o){var n=this.doc.createRange();this.doc.createElement("div");n.selectNode(this.doc.getElementsByTagName("div").item(0)),e=n.createContextualFragment(t)}return e}},{key:"reverseCreate",value:function(e){var t={};if("#text"===e.nodeName)t.isTextNode=!0,t.content=e.nodeValue;else{if(t.tag=e.nodeName.toLowerCase(),void 0!==e.attributes&&e.attributes.length>0){t.attr={};for(var n=e.attributes.length-1;n>=0;n--)t.attr[e.attributes.item(n).name]=e.attributes.item(n).value}if(void 0!==e.childNodes&&e.childNodes.length>0){t.append=[];for(var o=0;o<=e.childNodes.length-1;o++)t.append.push(this.reverseCreate(e.childNodes.item(o)))}}return t}},{key:"reverseCreateFromString",value:function(e){return this.reverseCreate(this.eltFromString(e))}}]),e}();module.exports=Jsi;

},{}]},{},[1])(1)
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJlczYvanNpLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO28zQkNDSSx3QkFDSSxHQUFBLFNBQUksTUFDQSxlQUVKLElBQUEsT0FDQSxRQUFlLEdBQWYsVUFFQSxTQUFnQixHQUFoQixVQUNBLFNBQUEsSUFBQSxVQUFBLGNBQ0EsU0FBQSxJQUFBLFdBQUEsZUFDQSxTQUFBLElBQUEsVUFBQSxjQUNBLFNBQUEsSUFBQSxTQUFBLGFBQ0EsU0FBQSxJQUFBLFVBQUEsY0FDQSxTQUFBLElBQUEsYUFBQSxpQkFDQSxTQUFBLElBQUEsV0FBQSxlQUNBLFNBQUEsSUFBQSxpQkFBQSxxQkFDQSxTQUFBLElBQUEsa0JBQUEsc0JBQ0EsU0FBQSxJQUFBLFNBQUEsYUFDQSxTQUFBLElBQUEsUUFBQSxZQUNBLFNBQUEsSUFBQSxhQUFBLGlCQUNBLFNBQUEsSUFBQSxZQUFBLGdCQUNBLFNBQUEsSUFBQSxjQUFBLGtCQUNBLFNBQUEsSUFBQSxZQUFBLGdCQUNBLFNBQUEsSUFBQSxlQUFBLG1CQUNBLFNBQUEsSUFBQSxlQUFBLG1CQUNBLFNBQUEsSUFBQSxjQUFBLGtCQUNBLFNBQUEsSUFBQSxhQUFBLGlCQUNBLFNBQUEsSUFBQSxjQUFBLGtCQUNBLFNBQUEsSUFBQSxVQUFBLGNBQ0EsU0FBQSxJQUFBLFdBQUEsZUFDQSxTQUFBLElBQUEsV0FBQSxlQUNBLFNBQUEsSUFBQSxXQUFBLGVBQ0EsU0FBQSxJQUFBLGVBQUEsbUJBQ0EsU0FBQSxJQUFBLGNBQUEsa0JBQ0EsU0FBQSxJQUFBLGFBQUEsaUJBQ0EsU0FBQSxJQUFBLFNBQUEsYUFDQSxTQUFBLElBQUEsWUFBQSxnQkFDQSxTQUFBLElBQUEsY0FBQSxrQkFDQSxTQUFBLElBQUEsY0FBQSxrQkFDQSxTQUFBLElBQUEsYUFBQSxpQkFDQSxTQUFBLElBQUEsY0FBQSxrQkFDQSxTQUFBLElBQUEsU0FBQSxhQUNBLFNBQUEsSUFBQSxVQUFBLGNB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QUFBLFFBQUEiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiY2xhc3MgSnNpe1xuICAgIGNvbnN0cnVjdG9yKGRvYyl7XG4gICAgICAgIGlmIChkb2MgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgZG9jID0gZG9jdW1lbnQ7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5kb2MgPSBkb2M7XG4gICAgICAgIHRoaXMuY3JlYXRlZCA9IG5ldyBNYXAoKTtcblxuICAgICAgICB0aGlzLmVsdEV2ZW50ID0gbmV3IE1hcCgpO1xuICAgICAgICB0aGlzLmVsdEV2ZW50LnNldCgnb25jbGljaycsICdjbGljaycpO1xuICAgICAgICB0aGlzLmVsdEV2ZW50LnNldCgnb25jaGFuZ2UnLCAnY2hhbmdlJyk7XG4gICAgICAgIHRoaXMuZWx0RXZlbnQuc2V0KCdvbmZvY3VzJywgJ2ZvY3VzJyk7XG4gICAgICAgIHRoaXMuZWx0RXZlbnQuc2V0KCdvbmJsdXInLCAnYmx1cicpO1xuICAgICAgICB0aGlzLmVsdEV2ZW50LnNldCgnb25rZXl1cCcsICdrZXl1cCcpO1xuICAgICAgICB0aGlzLmVsdEV2ZW50LnNldCgnb25rZXlwcmVzcycsICdrZXlwcmVzcycpO1xuICAgICAgICB0aGlzLmVsdEV2ZW50LnNldCgnb25zdWJtaXQnLCAnc3VibWl0Jyk7XG4gICAgICAgIHRoaXMuZWx0RXZlbnQuc2V0KCdvbmFuaW1hdGlvbmVuZCcsICdhbmltYXRpb25lbmQnKTtcbiAgICAgICAgdGhpcy5lbHRFdmVudC5zZXQoJ29udHJhbnNpdGlvbmVuZCcsICd0cmFuc2l0aW9uZW5kJyk7XG4gICAgICAgIHRoaXMuZWx0RXZlbnQuc2V0KCdvbmNvcHknLCAnY29weScpO1xuICAgICAgICB0aGlzLmVsdEV2ZW50LnNldCgnb25jdXQnLCAnY3V0Jyk7XG4gICAgICAgIHRoaXMuZWx0RXZlbnQuc2V0KCdvbmRibGNsaWNrJywgJ2RibGNsaWNrJyk7XG4gICAgICAgIHRoaXMuZWx0RXZlbnQuc2V0KCdvbmludmFsaWQnLCAnaW52YWxpZCcpO1xuICAgICAgICB0aGlzLmVsdEV2ZW50LnNldCgnb25tb3VzZWRvd24nLCAnbW91c2Vkb3duJyk7XG4gICAgICAgIHRoaXMuZWx0RXZlbnQuc2V0KCdvbm1vdXNldXAnLCAnbW91c2V1cCcpO1xuICAgICAgICB0aGlzLmVsdEV2ZW50LnNldCgnb25tb3VzZWVudGVyJywgJ21vdXNlZW50ZXInKTtcbiAgICAgICAgdGhpcy5lbHRFdmVudC5zZXQoJ29ubW91c2VsZWF2ZScsICdtb3VzZWxlYXZlJyk7XG4gICAgICAgIHRoaXMuZWx0RXZlbnQuc2V0KCdvbm1vdXNlbW92ZScsICdtb3VzZW1vdmUnKTtcbiAgICAgICAgdGhpcy5lbHRFdmVudC5zZXQoJ29ubW91c2VvdXQnLCAnbW91c2VvdXQnKTtcbiAgICAgICAgdGhpcy5lbHRFdmVudC5zZXQoJ29ubW91c2VvdmVyJywgJ21vdXNlb3ZlcicpO1xuICAgICAgICB0aGlzLmVsdEV2ZW50LnNldCgnb25wYXN0ZScsICdwYXN0ZScpO1xuICAgICAgICB0aGlzLmVsdEV2ZW50LnNldCgnb25yZXNpemUnLCAncmVzaXplJyk7XG4gICAgICAgIHRoaXMuZWx0RXZlbnQuc2V0KCdvbnNjcm9sbCcsICdzY3JvbGwnKTtcbiAgICAgICAgdGhpcy5lbHRFdmVudC5zZXQoJ29uc2VsZWN0JywgJ3NlbGVjdCcpO1xuICAgICAgICB0aGlzLmVsdEV2ZW50LnNldCgnb250b3VjaHN0YXJ0JywgJ3RvdWNoc3RhcnQnKTtcbiAgICAgICAgdGhpcy5lbHRFdmVudC5zZXQoJ29udG91Y2htb3ZlJywgJ3RvdWNobW92ZScpO1xuICAgICAgICB0aGlzLmVsdEV2ZW50LnNldCgnb250b3VjaGVuZCcsICd0b3VjaGVuZCcpO1xuICAgICAgICB0aGlzLmVsdEV2ZW50LnNldCgnb25kcmFnJywgJ2RyYWcnKTtcbiAgICAgICAgdGhpcy5lbHRFdmVudC5zZXQoJ29uZHJhZ2VuZCcsICdkcmFnZW5kJyk7XG4gICAgICAgIHRoaXMuZWx0RXZlbnQuc2V0KCdvbmRyYWdlbnRlcicsICdkcmFnZW50ZXInKTtcbiAgICAgICAgdGhpcy5lbHRFdmVudC5zZXQoJ29uZHJhZ2xlYXZlJywgJ2RyYWdsZWF2ZScpO1xuICAgICAgICB0aGlzLmVsdEV2ZW50LnNldCgnb25kcmFnb3ZlcicsICdkcmFnb3ZlcicpO1xuICAgICAgICB0aGlzLmVsdEV2ZW50LnNldCgnb25kcmFnc3RhcnQnLCAnZHJhZ3N0YXJ0Jyk7XG4gICAgICAgIHRoaXMuZWx0RXZlbnQuc2V0KCdvbmRyb3AnLCAnZHJvcCcpO1xuICAgICAgICB0aGlzLmVsdEV2ZW50LnNldCgnb25pbnB1dCcsICdpbnB1dCcpO1xuICAgICAgICB0aGlzLmVsdEV2ZW50LnNldCgnb25sb2Fkc3RhcnQnLCAnbG9hZHN0YXJ0Jyk7XG4gICAgICAgIHRoaXMuZWx0RXZlbnQuc2V0KCdvbnByb2dyZXNzJywgJ3Byb2dyZXNzJyk7XG4gICAgICAgIHRoaXMuZWx0RXZlbnQuc2V0KCdvbnN1c3BlbmQnLCAnc3VzcGVuZCcpO1xuICAgICAgICB0aGlzLmVsdEV2ZW50LnNldCgnb25hYm9ydCcsICdhYm9ydCcpO1xuICAgICAgICB0aGlzLmVsdEV2ZW50LnNldCgnb25lcnJvcicsICdlcnJvcicpO1xuICAgICAgICB0aGlzLmVsdEV2ZW50LnNldCgnb25lbXB0aWVkJywgJ2VtcHRpZWQnKTtcbiAgICAgICAgdGhpcy5lbHRFdmVudC5zZXQoJ29uc3RhbGxlZCcsICdzdGFsbGVkJyk7XG4gICAgICAgIHRoaXMuZWx0RXZlbnQuc2V0KCdvbmxvYWRlZG1ldGFkYXRhJywgJ2xvYWRlZG1ldGFkYXRhJyk7XG4gICAgICAgIHRoaXMuZWx0RXZlbnQuc2V0KCdvbmxvYWRlZGRhdGEnLCAnbG9hZGVkZGF0YScpO1xuICAgICAgICB0aGlzLmVsdEV2ZW50LnNldCgnb25jYW5wbGF5JywgJ2NhbnBsYXknKTtcbiAgICAgICAgdGhpcy5lbHRFdmVudC5zZXQoJ29uY2FucGxheXRocm91Z2gnLCAnY2FucGxheXRocm91Z2gnKTtcbiAgICAgICAgdGhpcy5lbHRFdmVudC5zZXQoJ29ucGxheWluZycsICdwbGF5aW5nJyk7XG4gICAgICAgIHRoaXMuZWx0RXZlbnQuc2V0KCdvbndhaXRpbmcnLCAnd2FpdGluZycpO1xuICAgICAgICB0aGlzLmVsdEV2ZW50LnNldCgnb25zZWVraW5nJywgJ3NlZWtpbmcnKTtcbiAgICAgICAgdGhpcy5lbHRFdmVudC5zZXQoJ29uc2Vla2VkJywgJ3NlZWtlZCcpO1xuICAgICAgICB0aGlzLmVsdEV2ZW50LnNldCgnb25lbmRlZCcsICdlbmRlZCcpO1xuICAgICAgICB0aGlzLmVsdEV2ZW50LnNldCgnb25kdXJhdGlvbmNoYW5nZScsICdkdXJhdGlvbmNoYW5nZScpO1xuICAgICAgICB0aGlzLmVsdEV2ZW50LnNldCgnb250aW1ldXBkYXRlJywgJ3RpbWV1cGRhdGUnKTtcbiAgICAgICAgdGhpcy5lbHRFdmVudC5zZXQoJ29ucGxheScsICdwbGF5Jyk7XG4gICAgICAgIHRoaXMuZWx0RXZlbnQuc2V0KCdvbnBhdXNlJywgJ3BhdXNlJyk7XG4gICAgICAgIHRoaXMuZWx0RXZlbnQuc2V0KCdvbnJhdGVjaGFuZ2UnLCAncmF0ZWNoYW5nZScpO1xuICAgICAgICB0aGlzLmVsdEV2ZW50LnNldCgnb25yZXNpemUnLCAncmVzaXplJyk7XG4gICAgICAgIHRoaXMuZWx0RXZlbnQuc2V0KCdvbnZvbHVtZWNoYW5nZScsICd2b2x1bWVjaGFuZ2UnKTtcblxuICAgIH1cblxuICAgIC8qKlxuICAgICogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQgc2hvcmN1dFxuICAgICogQHBhcmFtIHtzdHJpbmd9IGlkIHRoZSBlbGVtZW50IGlkXG4gICAgKiBAcmV0dXJuIHtvYmplY3R9IERPTUVsZW1lbnRcbiAgICAqL1xuICAgIGlkKGlkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRvYy5nZXRFbGVtZW50QnlJZChpZCk7XG4gICAgfVxuICAgIC8qKlxuICAgICogZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCBzaG9yY3V0XG4gICAgKiBAcGFyYW0ge3N0cmluZ30gcXVlcnkgdGhlIHNlbGVjdG9yXG4gICAgKiBAcmV0dXJuIHtET01Ob2RlTGlzdH1cbiAgICAqL1xuICAgIHF1ZXJ5KHF1ZXJ5KSB7XG4gICAgICAgIGxldCByZXMgPSB0aGlzLmRvYy5xdWVyeVNlbGVjdG9yQWxsKHF1ZXJ5KTtcbiAgICAgICAgaWYgKHJlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgICB9XG4gICAgICAgIGVsc2V7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICogZG9jdW1lbnQucXVlcnlTZWxlY3RvciBzaG9yY3V0XG4gICAgKiBAcGFyYW0ge3N0cmluZ30gcXVlcnkgdGhlIHNlbGVjdG9yXG4gICAgKiBAcmV0dXJuIHtET01FbGVtZW50fVxuICAgICovXG4gICAgcXVlcnlGaXJzdChxdWVyeSkge1xuICAgICAgICByZXR1cm4gdGhpcy5kb2MucXVlcnlTZWxlY3RvcihxdWVyeSk7XG4gICAgfVxuXG4gICAgc2VsZWN0KHEpe1xuICAgICAgICBsZXQgcmVzID0gdGhpcy5pZChxKTtcbiAgICAgICAgaWYgKHJlcyA9PT0gbnVsbCkge1xuICAgICAgICAgICAgcmVzID0gdGhpcy5xdWVyeUZpcnN0KHEpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgKiBhcHBlbmQgYW4gZWxlbWVudCB0byBhIHBhcmVudFxuICAgICogQHBhcmFtIHtET01FbGVtZW50fHN0cmluZ30gcGFyZW50IHRoZSBlbGVtZW50IHRvIGFwcGVuZCB0byBvciBpdHMgaWRcbiAgICAqIEBwYXJhbSB7RE9NRWxlbWVudHxvYmplY3R9IGVsdCBvciB0ZW1wbGF0ZSBvYmplY3QgdG8gYXBwZW5kIHRvIHBhcmVudFxuICAgICogQHJldHVybiB7RE9NRWxlbWVudH0gb2JqZWN0XG4gICAgKi9cbiAgICBhcHBlbmQocGFyZW50LCBlbHQsIGdldFBhcmVudCkge1xuICAgICAgICBpZiAoZWx0LnRhZyAhPT0gdW5kZWZpbmVkIHx8IGVsdC5pc1RleHROb2RlICE9PSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICBlbHQgPSB0aGlzLmNyZWF0ZShlbHQpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2YgcGFyZW50ICE9ICdvYmplY3QnKSB7XG4gICAgICAgICAgICBwYXJlbnQgPSB0aGlzLnNlbGVjdChwYXJlbnQpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHBhcmVudCAhPT0gbnVsbCAmJiBwYXJlbnQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgbGV0IHJlcyA9IHBhcmVudC5hcHBlbmRDaGlsZChlbHQpO1xuICAgICAgICAgICAgaWYgKGdldFBhcmVudCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgcmVzID0gcGFyZW50O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgICAgfVxuICAgICAgICB0aHJvdyBwYXJlbnQgKyAnIGNhbm5vdCBiZSBmb3VuZCc7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgKiBhcHBlbmQgYW4gZWxlbWVudCBiZWZvcmUgYW5vdGhlclxuICAgICogQHBhcmFtIGVsdCBtaXhlZCB0aGUgZWxlbWVudCB0byBhcHBlbmQgdG8gb3IgaXRzIGlkXG4gICAgKiBAcGFyYW0gbl9lbHQgbWl4ZWQgRE9NRWxlbWVudCBvciB0ZW1wbGF0ZSBvYmplY3QgdG8gYXBwZW5kIHRvIHBhcmVudFxuICAgICogQHJldHVybiBvYmplY3QgRE9NRWxlbWVudFxuICAgICovXG4gICAgYXBwZW5kQmVmb3JlKGVsdCwgbl9lbHQpIHtcbiAgICAgICAgaWYgKG5fZWx0LnRhZyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBuX2VsdCA9IHRoaXMuY3JlYXRlKG5fZWx0KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIGVsdCAhPSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgZWx0ID0gdGhpcy5zZWxlY3QoZWx0KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChlbHQgIT09IG51bGwgJiYgZWx0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybiBlbHQucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUobl9lbHQsIGVsdCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aHJvdyBlbHQgKyAnIGNhbm5vdCBiZSBmb3VuZCc7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgKiBhcHBlbmQgYW4gZWxlbWVudCBhZnRlciBhbm90aGVyXG4gICAgKiBAcGFyYW0gZWx0IG1peGVkIHRoZSBlbGVtZW50IHRvIGFwcGVuZCB0byBvciBpdHMgaWRcbiAgICAqIEBwYXJhbSBuX2VsdCBtaXhlZCBET01FbGVtZW50IG9yIHRlbXBsYXRlIG9iamVjdCB0byBhcHBlbmQgdG8gcGFyZW50XG4gICAgKiBAcmV0dXJuIG9iamVjdCBET01FbGVtZW50XG4gICAgKi9cbiAgICBhcHBlbmRBZnRlcihlbHQsIG5fZWx0KSB7XG4gICAgICAgIGlmIChuX2VsdC50YWcgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgbl9lbHQgPSB0aGlzLmNyZWF0ZShuX2VsdCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiBlbHQgIT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgIGVsdCA9IHRoaXMuc2VsZWN0KGVsdCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZWx0ICE9PSBudWxsICYmIGVsdCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4gZWx0LnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKG5fZWx0LCBlbHQubmV4dFNpYmxpbmcpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhyb3cgZWx0ICsgJyBjYW5ub3QgYmUgZm91bmQnO1xuICAgIH1cblxuICAgIC8qKlxuICAgICogYXBwZW5kIGFuIGVsZW1lbnQgdG8gYSBwYXJlbnQgYXMgaXRzIGZpcnN0IGNoaWxkXG4gICAgKiBAcGFyYW0gcGFyZW50IG1peGVkIHRoZSBlbGVtZW50IHRvIGFwcGVuZCB0byBvciBpdHMgaWRcbiAgICAqIEBwYXJhbSBlbHQgbWl4ZWQgRE9NRWxlbWVudCBvciB0ZW1wbGF0ZSBvYmplY3QgdG8gYXBwZW5kIHRvIHBhcmVudFxuICAgICogQHJldHVybiBvYmplY3QgRE9NRWxlbWVudFxuICAgICovXG4gICAgcHJlcGVuZChwYXJlbnQsIGVsdCkge1xuICAgICAgICBpZiAoZWx0LnRhZyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBlbHQgPSB0aGlzLmNyZWF0ZShlbHQpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2YgcGFyZW50ICE9ICdvYmplY3QnKSB7XG4gICAgICAgICAgICBwYXJlbnQgPSB0aGlzLnNlbGVjdChwYXJlbnQpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHBhcmVudCAhPT0gbnVsbCAmJiBwYXJlbnQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaWYgKHBhcmVudC5jaGlsZE5vZGVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmFwcGVuZChwYXJlbnQsIGVsdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNle1xuICAgICAgICAgICAgICAgIHJldHVybiBwYXJlbnQuaW5zZXJ0QmVmb3JlKGVsdCwgcGFyZW50LmZpcnN0Q2hpbGQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhyb3cgcGFyZW50ICsgJyBjYW5ub3QgYmUgZm91bmQnO1xuICAgIH1cblxuICAgIC8qKlxuICAgICogcmVwbGFjZSBhbiBlbGVtZW50XG4gICAgKiBAcmV0dXJuIG9iamVjdCBET01FbGVtZW50XG4gICAgKi9cbiAgICByZXBsYWNlKGVsdCwgbl9lbHQpIHtcbiAgICAgICAgaWYgKG5fZWx0LnRhZyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBuX2VsdCA9IHRoaXMuY3JlYXRlKG5fZWx0KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIGVsdCAhPSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgZWx0ID0gdGhpcy5zZWxlY3QoZWx0KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChlbHQgIT09IG51bGwgJiYgZWx0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGxldCBwYXJlbnQgPSBlbHQucGFyZW50Tm9kZTtcbiAgICAgICAgICAgIHJldHVybiBwYXJlbnQucmVwbGFjZUNoaWxkKG5fZWx0LCBlbHQpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhyb3cgZWx0ICsgJyBjYW5ub3QgYmUgZm91bmQnO1xuICAgIH1cblxuICAgIC8qXG4gICAgKiBkZXN0cm95IGEgRG9tIGVsZW1lbnRcbiAgICAqIEBwYXJhbSBlbHQgbWl4ZWQgaWQgb2YgdGhlIGVsZW1lbnQgb3IgZWxlbWVudCBpdHNlbGZcbiAgICAqL1xuICAgIHJlbW92ZShlbHQpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBlbHQgIT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgIGVsdCA9IHRoaXMuc2VsZWN0KGVsdCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZWx0ICE9PSBudWxsICYmIGVsdCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4gZWx0LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZWx0KTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICogZW1wdHkgRG9tIGVsZW1lbnQgZnJvbSBpdCdzIGNoaWxkcmVuLlxuICAgICovXG4gICAgZW1wdHkoZWx0KSB7XG4gICAgICAgIGlmICh0eXBlb2YgZWx0ICE9ICdvYmplY3QnKSB7XG4gICAgICAgICAgICBlbHQgPSB0aGlzLnNlbGVjdChlbHQpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGVsdCAhPT0gbnVsbCAmJiBlbHQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgd2hpbGUoZWx0Lmxhc3RDaGlsZCl7XG4gICAgICAgICAgICAgICAgZWx0LnJlbW92ZUNoaWxkKGVsdC5sYXN0Q2hpbGQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gZWx0O1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgKiBjcmVhdGUgYSB0ZXh0IG5vZGVcbiAgICAqIEBwYXJhbSBjb250ZW50IHN0cmluZyB0aGUgY29udGVudCBvZiB0aGUgdGV4dCBub2RlXG4gICAgKi9cbiAgICB0ZXh0Tm9kZShjb250ZW50KXtcbiAgICAgICAgcmV0dXJuIHRoaXMuZG9jLmNyZWF0ZVRleHROb2RlKGNvbnRlbnQpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICogY3JlYXRlIGFuIGVsZW1lbnQgZnJvbSBhIHRlbXBsYXRlIG9iamVjdFxuICAgICogQHBhcmFtIHtvYmplY3R9IGMgdGhlIHRlbXBsYXRlIG9iamVjdCB0byBiZSBjcmVhdGVkXG4gICAgKiBAcmV0dXJuIHtvYmplY3R9IERPTUVsZW1lbnRcbiAgICAqICAgICAgIDxwcmU+XG4gICAgKiAgICAgICB7XG4gICAgKlx0ICAgICAgICBcInRhZ1wiOlwidHlwZSBvZiBlbGVtZW50XCIsXG4gICAgKlx0ICAgICAgICBcImF0dHJcIjp7XG4gICAgKlx0XHQgICAgICAgIFwiYXR0cmlidXRlMVwiOlwidmFsdWUgb2YgYXR0ciAxXCIsXG4gICAgKlx0XHQgICAgICAgIFwiLi4uXCI6XCIuLi5cIlxuICAgICpcdCAgICAgICAgfSxcbiAgICAqXHQgICAgICAgIFwiaW5uZXJcIjpcInRoZSB0ZXh0IGNvbnRlbnQgb2YgdGhlIG5vZGVcIlxuICAgICogICAgICAgfVxuICAgICogICAgICAgPC9wcmU+XG4gICAgKi9cbiAgICBjcmVhdGUoYykge1xuICAgICAgICBsZXQgZWx0ID0gbnVsbDtcbiAgICAgICAgaWYgKGMuaXNUZXh0Tm9kZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBlbHQgPSB0aGlzLnRleHROb2RlKGMuY29udGVudCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZXtcbiAgICAgICAgICAgIC8vIGNoZWNrIGlmIHRoZSBlbGVtZW50IHRhZyBoYXMgYWxyZWFkeSBiZWVuIGNyZWF0ZWQgdG8gY2xvbmUgaXRcbiAgICAgICAgICAgIGlmICghdGhpcy5jcmVhdGVkLmhhcyhjLnRhZykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZWQuc2V0KGMudGFnLCB0aGlzLmRvYy5jcmVhdGVFbGVtZW50KGMudGFnKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHQgPSB0aGlzLmNyZWF0ZWQuZ2V0KGMudGFnKS5jbG9uZU5vZGUoKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gY3JlYXRlIGVsZW1lbnQgYXR0cmlidXRlXG4gICAgICAgICAgICBpZihjLmF0dHIgIT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmb3IobGV0IGtleSBpbiBjLmF0dHIpXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAvLyBoYW5kbGUgZWxlbWVudCBldmVudCBvciBjZXJ0YWluIHNwZWNpZmljIGF0dHJpYnV0ZVxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5lbHRFdmVudC5oYXMoa2V5KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZWx0LmFkZEV2ZW50TGlzdGVuZXIodGhpcy5lbHRFdmVudC5nZXQoa2V5KSwgYy5hdHRyW2tleV0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2V7XG4gICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2goa2V5KXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2NoZWNrZWQnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsdC5jaGVja2VkID0gYy5hdHRyW2tleV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdjbGFzc05hbWUnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsdC5zZXRBdHRyaWJ1dGUoJ2NsYXNzJyxjLmF0dHJba2V5XSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsdC5zZXRBdHRyaWJ1dGUoa2V5LGMuYXR0cltrZXldKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gaW4gc29tZSBjYXNlIHlvdSB3YW50IHRvIGJlIGFibGUgdG8gZm9yY2UgaW5uZXJIVE1MIHZhbHVlLCBcbiAgICAgICAgICAgIC8vIC8hXFwgVEhJUyBJUyBCQUFBQUFBRCAhXG4gICAgICAgICAgICBpZiAoYy5pbm5lckZvcmNlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBlbHQuaW5uZXJIVE1MID0gYy5pbm5lckZvcmNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBhcHBlbmQgZWxlbWVudHMgaWYgdGhlcmUgYXJlIHNvbWUgXG4gICAgICAgICAgICBpZiAoYy5hcHBlbmQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGFwIGluIGMuYXBwZW5kKSB7XG4gICAgICAgICAgICAgICAgICAgIGVsdCA9IHRoaXMuYXBwZW5kKGVsdCwgYy5hcHBlbmRbYXBdLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIGNyZWF0ZSBpbm5lciB0ZXh0IGNvbnRlbnQgbm9kZSBhbmQgYXBwZW5kIGl0XG4gICAgICAgICAgICBpZiAoYy5pbm5lciAhPT0gdW5kZWZpbmVkKXtcbiAgICAgICAgICAgICAgICBlbHQuYXBwZW5kQ2hpbGQodGhpcy50ZXh0Tm9kZShjLmlubmVyKSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChjLmluaXRDYWxsYmFjayAhPT0gdW5kZWZpbmVkICYmIHR5cGVvZiBjLmluaXRDYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGMuaW5pdENhbGxiYWNrKGVsdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZWx0O1xuICAgIH1cblxuICAgIGVsdEZyb21TdHJpbmcoZWx0KSB7XG4gICAgICAgIGxldCBlbCA9IGVsdDtcbiAgICAgICAgdHJ5e1xuICAgICAgICAgICAgZWx0ID0gbmV3IFJhbmdlKCkuY3JlYXRlQ29udGV4dHVhbEZyYWdtZW50KGVsKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaChlKXtcbiAgICAgICAgICAgIGxldCByYW5nZSA9IHRoaXMuZG9jLmNyZWF0ZVJhbmdlKCk7XG4gICAgICAgICAgICBsZXQgZGl2ID0gdGhpcy5kb2MuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICByYW5nZS5zZWxlY3ROb2RlKHRoaXMuZG9jLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiZGl2XCIpLml0ZW0oMCkpO1xuICAgICAgICAgICAgZWx0ID0gcmFuZ2UuY3JlYXRlQ29udGV4dHVhbEZyYWdtZW50KGVsKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZWx0O1xuICAgIH1cblxuICAgIHJldmVyc2VDcmVhdGUoZWx0KXtcbiAgICAgICAgbGV0IG5fZWx0ID0ge307XG5cbiAgICAgICAgaWYgKGVsdC5ub2RlTmFtZSA9PT0gJyN0ZXh0Jykge1xuICAgICAgICAgICAgbl9lbHQuaXNUZXh0Tm9kZSA9IHRydWU7XG4gICAgICAgICAgICBuX2VsdC5jb250ZW50ID0gZWx0Lm5vZGVWYWx1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNle1xuICAgICAgICAgICAgbl9lbHQudGFnID0gZWx0Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIChlbHQuYXR0cmlidXRlcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgaWYgKGVsdC5hdHRyaWJ1dGVzLmxlbmd0aCA+MCkge1xuICAgICAgICAgICAgICAgICAgICBuX2VsdC5hdHRyID0ge307XG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSBlbHQuYXR0cmlidXRlcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbl9lbHQuYXR0cltlbHQuYXR0cmlidXRlcy5pdGVtKGkpLm5hbWVdID0gZWx0LmF0dHJpYnV0ZXMuaXRlbShpKS52YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKGVsdC5jaGlsZE5vZGVzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoZWx0LmNoaWxkTm9kZXMubGVuZ3RoID4wKSB7XG4gICAgICAgICAgICAgICAgICAgIG5fZWx0LmFwcGVuZCA9IFtdO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8PSBlbHQuY2hpbGROb2Rlcy5sZW5ndGggLSAxOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5fZWx0LmFwcGVuZC5wdXNoKHRoaXMucmV2ZXJzZUNyZWF0ZShlbHQuY2hpbGROb2Rlcy5pdGVtKGkpKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbl9lbHQ7XG4gICAgfVxuXG4gICAgcmV2ZXJzZUNyZWF0ZUZyb21TdHJpbmcoZWx0KXtcbiAgICAgICAgcmV0dXJuIHRoaXMucmV2ZXJzZUNyZWF0ZSh0aGlzLmVsdEZyb21TdHJpbmcoZWx0KSk7XG4gICAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IEpzaTsiXX0=
